<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>MAP E.D.E.N. — Welcome</title>
  <meta name="theme-color" content="#000000" />

  <style>
    :root{
      --bg0:#000;
      --bg1:#060a14;
      --glass: rgba(12,14,18,0.62);
      --stroke: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --muted2: rgba(255,255,255,0.50);

      --green: rgba(120,255,200,0.92);
      --greenGlow: rgba(120,255,200,0.22);
    }

    html,body{
      height:100%;
      margin:0;
      background: radial-gradient(1200px 700px at 50% 20%, rgba(70,110,255,0.16), transparent 55%),
                  radial-gradient(900px 600px at 15% 70%, rgba(0,200,255,0.10), transparent 60%),
                  linear-gradient(180deg, var(--bg0), var(--bg1));
      color: var(--text);
      font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial;
      -webkit-font-smoothing: antialiased;
      overflow:hidden;
    }

    body:before{
      content:"";
      position:fixed; inset:0;
      background-image:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,0.10) 0 1px, transparent 2px),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,0.07) 0 1px, transparent 2px),
        radial-gradient(circle at 60% 80%, rgba(255,255,255,0.06) 0 1px, transparent 2px);
      background-size: 420px 420px, 520px 520px, 620px 620px;
      opacity:0.55;
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .wrap{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 20px;
      box-sizing:border-box;
    }

    .panel{
      width: min(980px, calc(100vw - 24px));
      max-height: min(86vh, 820px);
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 22px 80px rgba(0,0,0,0.60);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .top{
      padding: 16px 18px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 0;
    }

    .title{
      font-weight: 900;
      letter-spacing: 0.25px;
      font-size: 20px;
      line-height: 1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .sub{
      font-weight: 650;
      font-size: 12px;
      line-height: 1.25;
      color: var(--muted);
      max-width: 720px;
    }

    .badgeRow{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top: 2px;
      flex-wrap:wrap;
    }

    .badge{
      font-size: 11px;
      font-weight: 800;
      color: rgba(255,255,255,0.78);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      padding: 8px 10px;
      border-radius: 999px;
      letter-spacing: 0.2px;
      white-space:nowrap;
    }

    .badge .dot{
      display:inline-block;
      width:10px; height:10px;
      border-radius:50%;
      margin-right:8px;
      background: rgba(255,255,255,0.18);
      vertical-align:-1px;
      box-shadow:none;
    }

    .badge.on{
      border-color: rgba(255,255,255,0.22);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.06) inset, 0 0 22px rgba(255,255,255,0.08);
    }
    .badge.on .dot{
      background: var(--green);
      box-shadow: 0 0 18px var(--greenGlow);
    }

    .body{
      padding: 18px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      background: rgba(0,0,0,0.14);
    }

    .card{
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.25);
    }

    h2{
      margin: 0 0 10px;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: 0.2px;
    }
    p{
      margin: 0 0 12px;
      color: rgba(255,255,255,0.80);
      font-size: 14px;
      line-height: 1.6;
      font-weight: 650;
    }

    .hr{
      height:1px;
      background: rgba(255,255,255,0.10);
      margin: 14px 0;
    }

    .miniGrid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 10px;
      margin-top: 14px;
    }

    .btn{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-weight: 900;
      font-size: 13px;
      letter-spacing: 0.15px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      text-decoration:none;
    }
    .btn:active{ transform: translateY(1px); }

    .btn .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .btn .label{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .btn .dot{
      width:10px; height:10px;
      border-radius:50%;
      background: rgba(255,255,255,0.18);
      box-shadow:none;
      flex:0 0 auto;
    }

    .btn.on{
      border-color: rgba(255,255,255,0.22);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.06) inset, 0 0 26px rgba(255,255,255,0.08);
    }
    .btn.on .dot{
      background: var(--green);
      box-shadow: 0 0 18px var(--greenGlow);
    }

    .hint{
      color: var(--muted2);
      font-weight: 800;
      font-size: 11px;
      line-height: 1.2;
      text-align:right;
      white-space:nowrap;
    }

    .foot{
      padding: 14px 18px 16px;
      border-top: 1px solid rgba(255,255,255,0.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      color: var(--muted2);
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 0.12px;
      background: rgba(0,0,0,0.10);
    }

    .link{
      color: rgba(255,255,255,0.86);
      text-decoration:none;
      border-bottom: 1px solid rgba(255,255,255,0.18);
      padding-bottom:2px;
    }

    @media (max-width: 640px){
      .miniGrid{ grid-template-columns: 1fr; }
      .sub{ max-width: 360px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="panel" role="main" aria-label="MAP E.D.E.N. Welcome">
      <div class="top">
        <div class="brand">
          <div class="title">MAP E.D.E.N.</div>
          <div class="sub">Earth Diametric Energy Network • Operational field platform for Project E.D.E.N.</div>

          <div class="badgeRow" aria-label="Status lights">
            <div class="badge" id="lightWelcome"><span class="dot"></span>Welcome</div>
            <div class="badge" id="lightMission"><span class="dot"></span>Mission</div>
            <div class="badge" id="lightSwitch"><span class="dot"></span>Switchboard</div>
          </div>
        </div>

        <div class="badge" style="border-color:rgba(255,255,255,0.20);">
          <span class="dot" style="background:rgba(246,194,74,0.85); box-shadow:0 0 18px rgba(246,194,74,0.18);"></span>
          42° / 222° Axis
        </div>
      </div>

      <div class="body">
        <div class="card">
          <h2>WELCOME</h2>
          <p>
            Welcome to <b>MAP E.D.E.N.</b> — the operational globe for <b>Project E.D.E.N.</b>, beginning with the
            <b>42° / 222° diametric axis</b> (opposite bearings on the same straight line).
          </p>

          <div class="hr"></div>

          <h2>MISSION</h2>
          <p>
            <b>MAP E.D.E.N.</b> is the operational field platform for <b>Project E.D.E.N. (Earth Diametric &amp; Energy Network)</b> —
            a secure, repeatable way to run real-world tests along defined Earth corridors, beginning with the
            <b>42° / 222°</b> diametric axis.
          </p>
          <p>
            Based on a 20+ year personal observation record, the Founder identified “222” as a persistent recurring numeric event marker
            across routine environments (time displays, identifiers, signage). This long-duration recurrence served as the initial trigger
            for structuring Project E.D.E.N. as a measurement-first field program.
          </p>
          <p>
            Over time, and in multiple documented sessions, the “222” event marker also coincided with a compass bearing of <b>222° (SW)</b> —
            reinforcing the <b>42/222</b> line as a repeatable corridor for formal testing. MAP E.D.E.N. equips trusted operators with clear
            protocols to collect environmental field measurements and navigation-behavior observations, including potential biological
            magnetoreception and magnetically influenced orientation in animals and insects, so results can be compared across time.
          </p>

          <div class="hr"></div>

          <h2>WHAT YOU CAN DO HERE</h2>
          <p style="margin-bottom:0;">
            Use these buttons exactly like your main app’s controls — each one turns its light green when pressed.
          </p>

          <div class="miniGrid" role="group" aria-label="Welcome actions">
            <button class="btn" id="btnWelcome" type="button">
              <span class="left"><span class="dot"></span><span class="label">Welcome</span></span>
              <span class="hint">Light on</span>
            </button>

            <button class="btn" id="btnMission" type="button">
              <span class="left"><span class="dot"></span><span class="label">Mission</span></span>
              <span class="hint">Light on</span>
            </button>

            <a class="btn" id="btnSwitch" href="./index.html">
              <span class="left"><span class="dot"></span><span class="label">Switchboard</span></span>
              <span class="hint">Back to globe</span>
            </a>
          </div>

          <p style="margin-top:14px; color:rgba(255,255,255,0.70); font-size:12px;">
            Tip: This file must be named exactly <b>welcome.html</b> and placed in the repo root (next to <b>index.html</b>) so the globe app can load it reliably.
          </p>
        </div>
      </div>

      <div class="foot">
        <span>MAP E.D.E.N. • Running</span>
        <span><a class="link" href="./index.html">Open Globe</a></span>
      </div>
    </div>
  </div>

  <script>
    const setOn = (id, on) => document.getElementById(id)?.classList.toggle("on", !!on);

    // Default: Welcome light ON (because you’re on the welcome page)
    setOn("lightWelcome", true);

    const btnWelcome = document.getElementById("btnWelcome");
    const btnMission = document.getElementById("btnMission");

    btnWelcome?.addEventListener("click", () => {
      setOn("btnWelcome", true);
      setOn("lightWelcome", true);
    });

    btnMission?.addEventListener("click", () => {
      setOn("btnMission", true);
      setOn("lightMission", true);
      const headers = [...document.querySelectorAll("h2")];
      const mission = headers.find(h => (h.textContent || "").trim().toUpperCase() === "MISSION");
      if (mission) mission.scrollIntoView({ behavior: "smooth", block: "start" });
    });

    // If user taps Switchboard link, mark the light before navigating
    const btnSwitch = document.getElementById("btnSwitch");
    btnSwitch?.addEventListener("click", () => setOn("lightSwitch", true));
  </script>
</body>
</html>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>MAP E.D.E.N. Globe</title>

  <style>
    :root{
      --glass: rgba(12,14,18,0.60);
      --stroke: rgba(255,255,255,0.12);
      --stroke2: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --muted2: rgba(255,255,255,0.46);
    }

    html, body { height: 100%; margin: 0; background:#000; overflow:hidden; touch-action:none; }
    canvas { display:block; width:100vw !important; height:100vh !important; }

    #openBtn{
      position: fixed;
      left: 18px;
      bottom: 18px;
      z-index: 10000;
      display: none;
      align-items: center;
      padding: 12px 14px;
      border-radius: 18px;
      color: var(--text);
      background: rgba(12,14,18,0.62);
      border: 1px solid rgba(255,255,255,0.14);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 14px 44px rgba(0,0,0,0.42);
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      font: 900 13px/1 -apple-system, system-ui, Segoe UI, Roboto, Arial;
      letter-spacing: 0.35px;
    }
    #openBtn:active { transform: translateY(1px); }

    #drawer {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      width: min(820px, calc(100vw - 28px));
      max-height: calc(100vh - 28px);
      z-index: 9999;
      color: var(--text);
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      padding: 14px 14px 12px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 14px 44px rgba(0,0,0,0.42);
      user-select: none;
      overflow: hidden;
    }

    #drawer.closed{
      transform: translateX(-50%) translateY(140%);
      opacity: 0;
      pointer-events: none;
      transition: transform 240ms ease, opacity 200ms ease;
    }
    #drawer:not(.closed){
      transition: transform 240ms ease, opacity 200ms ease;
    }

    #handle {
      width: 44px;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.18);
      margin: 6px auto 10px;
      cursor: pointer;
    }

    #drawerTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    #titleBlock{
      display:flex;
      flex-direction:column;
      gap:4px;
      padding-right: 8px;
    }
    #title {
      font: 900 18px/1.1 -apple-system, system-ui, Segoe UI, Roboto, Arial;
      letter-spacing: 0.25px;
    }
    #subtitle{
      font: 650 12px/1.25 -apple-system, system-ui, Segoe UI, Roboto, Arial;
      color: var(--muted);
      max-width: 540px;
    }

    #closeBtn{
      width: 40px;
      height: 40px;
      border-radius: 14px;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      -webkit-tap-highlight-color: transparent;
      flex: 0 0 auto;
    }
    #closeBtn:active { transform: translateY(1px); }

    #drawerBody{
      margin-top: 12px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      max-height: calc(100vh - 190px);
      padding-bottom: 6px;
    }

    .gridTop{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .grid2{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .pill {
      width: 100%;
      display:inline-flex;
      align-items:center;
      justify-content: space-between;
      gap:10px;
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font: 900 14px/1 -apple-system, system-ui, Segoe UI, Roboto, Arial;
      letter-spacing: 0.15px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .pill:active { transform: translateY(1px); }

    .pill .left{
      display:inline-flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .pill .label{
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .dot {
      width: 10px; height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.16);
      box-shadow: 0 0 0 rgba(0,0,0,0);
      flex: 0 0 auto;
    }

    /* ON (green) */
    .pill.on .dot{ background: rgba(120,255,200,0.88); box-shadow: 0 0 16px rgba(120,255,200,0.24); }

    /* Switchboard glow (white) */
    .pill.switch.on{
      border-color: rgba(255,255,255,0.22);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.08) inset, 0 0 28px rgba(255,255,255,0.10);
    }
    .pill.switch.on .dot{
      background: rgba(255,255,255,0.92);
      box-shadow: 0 0 20px rgba(255,255,255,0.24);
    }

    #statusBar{
      margin-top: 10px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      color: var(--muted2);
      font: 800 11px/1.2 -apple-system, system-ui, Segoe UI, Roboto, Arial;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    #errors{
      margin-top: 10px;
      display:none;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,120,120,0.22);
      background: rgba(80,10,10,0.35);
      color: rgba(255,170,170,0.95);
      font: 650 11px/1.35 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      white-space: pre-wrap;
    }

    #drawer.collapsed #drawerBody,
    #drawer.collapsed #statusBar,
    #drawer.collapsed #errors { display:none; }
    #drawer.collapsed { padding-bottom: 12px; }

    #switchboardGroup{ display:none; }
    #switchboardGroup.on{ display:block; }

    /* Modal */
    #modalMask{
      position: fixed;
      inset: 0;
      z-index: 20000;
      background: rgba(0,0,0,0.62);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
    }
    #modalMask.on{ display:flex; }

    #modal{
      width: min(980px, calc(100vw - 24px));
      height: min(84vh, 780px);
      background: rgba(12,14,18,0.78);
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 22px;
      box-shadow: 0 20px 70px rgba(0,0,0,0.55);
      overflow: hidden;
      display:flex;
      flex-direction: column;
    }

    #modalTop{
      display:flex;
      align-items:center;
      justify-content: space-between;
      padding: 12px 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
    }
    #modalTitle{
      font: 900 14px/1 -apple-system, system-ui, Segoe UI, Roboto, Arial;
      letter-spacing: 0.3px;
      color: rgba(255,255,255,0.92);
      padding-left: 6px;
    }
    #modalClose{
      width: 40px;
      height: 40px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.92);
      cursor:pointer;
    }

    #modalBody{
      flex: 1 1 auto;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      background: rgba(0,0,0,0.15);
    }

    #welcomeFrame{
      width: 100%;
      height: 100%;
      border: 0;
      display:block;
      background: #000;
    }

    #missionContent{
      padding: 18px 18px 24px;
      color: rgba(255,255,255,0.88);
      font: 650 14px/1.55 -apple-system, system-ui, Segoe UI, Roboto, Arial;
      max-width: 920px;
      margin: 0 auto;
    }
    #missionContent h2{
      font: 900 18px/1.2 -apple-system, system-ui, Segoe UI, Roboto, Arial;
      margin: 0 0 10px;
      letter-spacing: 0.2px;
    }
    #missionContent p{ margin: 0 0 12px; color: rgba(255,255,255,0.80); }
  </style>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
      }
    }
  </script>
</head>

<body>
  <button id="openBtn" aria-label="Open MAP E.D.E.N.">MAP E.D.E.N.</button>

  <div id="drawer">
    <div id="handle" title="Tap to collapse/expand"></div>

    <div id="drawerTop">
      <div id="titleBlock">
        <div id="title">MAP E.D.E.N.</div>
        <div id="subtitle">Earth Diametric Energy Network • Tap Switchboard to open layers</div>
      </div>
      <button id="closeBtn" aria-label="Close drawer" title="Close">✕</button>
    </div>

    <div id="drawerBody">
      <div class="gridTop">
        <button class="pill" id="welcomeBtn">
          <span class="left"><span class="dot"></span><span class="label">Welcome</span></span>
        </button>

        <button class="pill" id="missionBtn">
          <span class="left"><span class="dot"></span><span class="label">Mission</span></span>
        </button>

        <button class="pill switch" id="switchboardBtn">
          <span class="left"><span class="dot"></span><span class="label">Switchboard</span></span>
          <span class="hint" id="switchHint">Tap to open</span>
        </button>
      </div>

      <div id="switchboardGroup">
        <!-- keep your layer buttons here (unchanged) -->
        <div id="errors"></div>
      </div>
    </div>

    <div id="statusBar">
      <span id="status">Booting…</span>
      <span id="stationText">Exit 222 • Station 1 @ 38°9′39″ N, 79°4′24″ W</span>
    </div>
  </div>

  <div id="modalMask" role="dialog" aria-modal="true" aria-label="MAP E.D.E.N. Modal">
    <div id="modal">
      <div id="modalTop">
        <div id="modalTitle">WELCOME</div>
        <button id="modalClose" aria-label="Close modal">✕</button>
      </div>
      <div id="modalBody">
        <iframe id="welcomeFrame" title="MAP E.D.E.N. Welcome" loading="lazy"></iframe>

        <div id="missionContent" style="display:none;">
          <h2>MAP E.D.E.N. Mission</h2>
          <p>
            Turn the 42° / 222° axis hypothesis into a coordinated, evidence-first experiment by producing sensor datasets
            that are repeatable, controlled, and comparable across stations and time.
          </p>
          <p>
            This globe is a visual switchboard for the core overlays (Rhumb, Great Circle, Corridors, Field previews) while keeping the Earth render clean.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import * as THREE from "three";
    import { EffectComposer } from "three/addons/postprocessing/EffectComposer.js";
    import { RenderPass } from "three/addons/postprocessing/RenderPass.js";
    import { ShaderPass } from "three/addons/postprocessing/ShaderPass.js";
    import { OutputPass } from "three/addons/postprocessing/OutputPass.js";
    import { UnrealBloomPass } from "three/addons/postprocessing/UnrealBloomPass.js";

    // ---------- UI ----------
    const statusEl   = document.getElementById("status");
    const errorsEl   = document.getElementById("errors");
    const drawerEl   = document.getElementById("drawer");
    const openBtn    = document.getElementById("openBtn");
    const closeBtn   = document.getElementById("closeBtn");
    const handle     = document.getElementById("handle");

    const welcomeBtn = document.getElementById("welcomeBtn");
    const missionBtn = document.getElementById("missionBtn");
    const switchBtn  = document.getElementById("switchboardBtn");
    const switchHint = document.getElementById("switchHint");
    const switchGrp  = document.getElementById("switchboardGroup");

    const modalMask  = document.getElementById("modalMask");
    const modalClose = document.getElementById("modalClose");
    const modalTitle = document.getElementById("modalTitle");
    const welcomeFrame = document.getElementById("welcomeFrame");
    const missionContent = document.getElementById("missionContent");

    function showError(msg){
      if (!errorsEl) return;
      errorsEl.style.display = "block";
      errorsEl.textContent += (errorsEl.textContent ? "\n\n" : "") + msg;
      statusEl.textContent = "Error (see panel)";
    }
    window.addEventListener("error", (e) => showError("JS Error:\n" + (e.message || e.error || e)));
    window.addEventListener("unhandledrejection", (e) => showError("Promise Rejection:\n" + (e.reason?.message || e.reason || e)));

    function setDrawerClosed(isClosed){
      drawerEl.classList.toggle("closed", !!isClosed);
      openBtn.style.display = isClosed ? "inline-flex" : "none";
    }
    setDrawerClosed(false);
    openBtn.addEventListener("click", () => setDrawerClosed(false));
    closeBtn.addEventListener("click", () => setDrawerClosed(true));
    handle.addEventListener("click", () => drawerEl.classList.toggle("collapsed"));

    // --------- Lights (green pills) ----------
    function setPillOn(el){ el?.classList.add("on"); }

    // Modal controls
    function openModal(kind){
      modalMask.classList.add("on");

      if (kind === "welcome"){
        setPillOn(welcomeBtn);               // ✅ Welcome turns green
        modalTitle.textContent = "WELCOME";
        missionContent.style.display = "none";
        welcomeFrame.style.display = "block";

        // ✅ ROOT-SAFE load: index.html + welcome.html in same folder
        welcomeFrame.src = new URL("welcome.html", location.href).href;

      } else {
        setPillOn(missionBtn);               // ✅ Mission turns green
        modalTitle.textContent = "MISSION";
        welcomeFrame.style.display = "none";
        missionContent.style.display = "block";
      }
    }

    function closeModal(){
      modalMask.classList.remove("on");
      if (welcomeFrame.style.display !== "none") welcomeFrame.src = "about:blank";
    }

    modalClose.addEventListener("click", closeModal);
    modalMask.addEventListener("click", (e)=>{ if(e.target === modalMask) closeModal(); });

    welcomeBtn.addEventListener("click", ()=>openModal("welcome"));
    missionBtn.addEventListener("click", ()=>openModal("mission"));

    // Switchboard (only show layer toggles when ON)
    let switchboardOn = false;
    function setSwitchboard(on){
      switchboardOn = !!on;
      switchBtn.classList.toggle("on", switchboardOn); // ✅ Switchboard turns green/white glow
      switchGrp.classList.toggle("on", switchboardOn);
      switchHint.textContent = switchboardOn ? "Tap to close" : "Tap to open";
    }
    switchBtn.addEventListener("click", ()=> setSwitchboard(!switchboardOn));
    setSwitchboard(false);

    // -----------------------------
    // Everything below here can remain as your current globe/three.js code.
    // (Paste your existing globe code under this comment.)
    // -----------------------------

    statusEl.textContent = "Running";

    // NOTE: You can paste your full Three.js globe code here unchanged.
    // I stopped here only because your request was specifically to fix
    // the “combine” problem + Welcome loading + green lights.
  </script>
</body>
</html>
