<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="referrer" content="no-referrer" />
  <title>MAP E.D.E.N.</title>

  <style>
    :root{
      --bg:#050508;
      --glass: rgba(12,14,18,.58);
      --glass2: rgba(12,14,18,.40);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(255,255,255,.18);
      --fg: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.52);
      --accent: rgba(140,255,220,.85);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      background: radial-gradient(1200px 800px at 70% 20%, rgba(90,140,255,.10), transparent 55%),
                  radial-gradient(900px 700px at 25% 30%, rgba(140,255,220,.08), transparent 55%),
                  var(--bg);
      color: var(--fg);
      font-family: -apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow:hidden;
    }

    /* Canvas */
    #stage{
      position: fixed;
      inset: 0;
      width:100%;
      height:100%;
      display:block;
      touch-action: none;
    }

    /* Minimal top badge (optional, unobtrusive) */
    .top-badge{
      position: fixed;
      top: calc(10px + env(safe-area-inset-top));
      left: calc(12px + env(safe-area-inset-left));
      z-index: 10;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      background: rgba(0,0,0,.20);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size: 12px;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: rgba(255,255,255,.75);
      user-select:none;
      pointer-events:none;
    }

    /* Bottom Sheet (single card, minimal) */
    .sheet{
      position: fixed;
      left: 0; right: 0;
      bottom: 0;
      z-index: 20;
      padding: 12px;
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }

    .card{
      max-width: 920px;
      margin: 0 auto;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      overflow:hidden;
    }

    .handle{
      width: 56px;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,.22);
      margin: 10px auto 6px auto;
      opacity:.8;
    }

    .card-inner{
      padding: 14px 14px 12px 14px;
    }

    .brand-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }

    .brand{
      display:flex;
      gap: 12px;
      align-items:center;
      min-width: 0;
    }

    .brand-mark{
      width: 62px;
      height: 62px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: radial-gradient(60px 60px at 30% 30%, rgba(255,255,255,.12), rgba(255,255,255,.02));
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex: 0 0 auto;
    }

    .brand-mark img{
      width: 92px;
      height: 92px;
      object-fit: contain;
      opacity: .95;
      transform: translateY(2px);
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.45));
    }

    .brand-text{
      min-width: 0;
    }

    .title{
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .06em;
      text-transform: uppercase;
      margin: 2px 0 4px 0;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .subtitle{
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
      margin: 0;
    }

    .xbtn{
      width: 42px;
      height: 42px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.78);
      font-size: 20px;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      flex: 0 0 auto;
    }

    /* Segmented tabs (Hello / Mission / Start) */
    .tabs{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }

    .tab{
      flex: 1 1 auto;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      color: rgba(255,255,255,.86);
      font-weight: 650;
      font-size: 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .tab.active{
      border-color: rgba(140,255,220,.24);
      background: rgba(140,255,220,.10);
      color: rgba(255,255,255,.95);
      box-shadow: 0 0 0 1px rgba(140,255,220,.10) inset;
    }

    /* Content */
    .content{
      margin-top: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      padding: 12px 12px;
    }

    .content p{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }

    .content strong{ color: rgba(255,255,255,.90); }

    /* Minimal action row (only visible in Start) */
    .actions{
      margin-top: 12px;
      display:none;
      gap: 10px;
      flex-wrap: wrap;
    }
    .actions.show{ display:flex; }

    .btn{
      flex: 1 1 140px;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      color: rgba(255,255,255,.86);
      font-weight: 650;
      font-size: 13px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .btn.primary{
      border-color: rgba(140,255,220,.26);
      background: rgba(140,255,220,.12);
    }

    .foot{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
      padding: 10px 14px 14px 14px;
      color: rgba(255,255,255,.55);
      font-size: 12px;
      border-top: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.10);
    }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing: .02em;
    }

    /* Small screens */
    @media (max-width: 420px){
      .brand-mark{ width: 56px; height: 56px; }
      .brand-mark img{ width: 86px; height: 86px; }
      .title{ font-size: 16px; }
    }
  </style>
</head>

<body>
  <canvas id="stage"></canvas>
  <div class="top-badge">MAP E.D.E.N.</div>

  <div class="sheet" id="sheet">
    <div class="card" role="dialog" aria-label="MAP E.D.E.N. Panel">
      <div class="handle"></div>

      <div class="card-inner">
        <div class="brand-row">
          <div class="brand">
            <div class="brand-mark" aria-hidden="true">
              <!-- Logo Architecture (drop in your PNG here): assets/map-eden-logo.png -->
              <img src="assets/map-eden-logo.png" alt="" onerror="this.style.display='none'; this.parentElement.style.opacity='.85'; this.parentElement.textContent='E.D.E.N.';" />
            </div>
            <div class="brand-text">
              <div class="title">MAP E.D.E.N.</div>
              <p class="subtitle">Earth Diametric Energy Network • <span class="mono">Signal &gt; Social</span></p>
            </div>
          </div>

          <button class="xbtn" id="collapseBtn" title="Minimize panel" aria-label="Minimize panel">×</button>
        </div>

        <div class="tabs" role="tablist" aria-label="Sections">
          <button class="tab active" id="tabHello" role="tab" aria-selected="true">Hello</button>
          <button class="tab" id="tabMission" role="tab" aria-selected="false">Mission</button>
          <button class="tab" id="tabStart" role="tab" aria-selected="false">Start</button>
        </div>

        <div class="content" id="content">
          <p>
            <strong>MAP E.D.E.N.</strong> is a signal network — not a social app with maps.
            It’s built for repeatable field work: minimal UI, clean capture, and comparable results.
            <br><br>
            Default ranking is <strong>Signal Score</strong> (data quality), never “likes.” Social is optional.
          </p>
        </div>

        <!-- Minimal actions only when Start is selected -->
        <div class="actions" id="actions">
          <button class="btn primary" id="toggleAxisBtn">Toggle 42° / 222° Axis</button>
          <button class="btn" id="addStationBtn">Add Station</button>
          <button class="btn" id="captureBtn">Capture Receipt</button>
        </div>
      </div>

      <div class="foot">
        <div>Local-first demo • storage: <strong class="mono">device only</strong></div>
        <div class="mono" id="statusText">Ready</div>
      </div>
    </div>
  </div>

  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

  <script>
    // =========================
    // Minimal MAP E.D.E.N. Globe
    // =========================
    const $ = (id) => document.getElementById(id);

    const statusText = $("statusText");
    const canvas = $("stage");

    // Panel behavior: tap × to shrink to a small bar (minimal)
    const sheet = $("sheet");
    const collapseBtn = $("collapseBtn");
    let collapsed = false;

    collapseBtn.addEventListener("click", () => {
      collapsed = !collapsed;
      if (collapsed){
        sheet.style.transform = "translateY(calc(100% - 68px))";
        collapseBtn.textContent = "▴";
        collapseBtn.title = "Expand panel";
        collapseBtn.setAttribute("aria-label","Expand panel");
        statusText.textContent = "Panel minimized";
      } else {
        sheet.style.transform = "translateY(0)";
        collapseBtn.textContent = "×";
        collapseBtn.title = "Minimize panel";
        collapseBtn.setAttribute("aria-label","Minimize panel");
        statusText.textContent = "Ready";
      }
    });

    // Tabs (Hello / Mission / Start)
    const tabHello = $("tabHello");
    const tabMission = $("tabMission");
    const tabStart = $("tabStart");
    const content = $("content");
    const actions = $("actions");

    function setActiveTab(which){
      [tabHello, tabMission, tabStart].forEach(t => t.classList.remove("active"));
      [tabHello, tabMission, tabStart].forEach(t => t.setAttribute("aria-selected","false"));

      if (which === "hello"){
        tabHello.classList.add("active");
        tabHello.setAttribute("aria-selected","true");
        actions.classList.remove("show");
        content.innerHTML = `
          <p>
            <strong>MAP E.D.E.N.</strong> is a signal network — not a social app with maps.
            It’s built for repeatable field work: minimal UI, clean capture, and comparable results.
            <br><br>
            Default ranking is <strong>Signal Score</strong> (data quality), never “likes.” Social is optional.
          </p>
        `;
        statusText.textContent = "Hello";
      }

      if (which === "mission"){
        tabMission.classList.add("active");
        tabMission.setAttribute("aria-selected","true");
        actions.classList.remove("show");
        content.innerHTML = `
          <p>
            <strong>Mission:</strong> turn the 42° / 222° axis hypothesis into a coordinated, evidence-first experiment
            by producing datasets that are repeatable, controlled, and comparable across stations and time.
            <br><br>
            The interface stays minimal so the work stays clean: <strong>capture → verify → replicate</strong>.
          </p>
        `;
        statusText.textContent = "Mission";
      }

      if (which === "start"){
        tabStart.classList.add("active");
        tabStart.setAttribute("aria-selected","true");
        actions.classList.add("show");
        content.innerHTML = `
          <p>
            <strong>Start</strong> is intentionally simple:
            <br>• Toggle the <strong>42° / 222°</strong> axis overlay
            <br>• Add a <strong>Station</strong> (truth anchor)
            <br>• Generate a <strong>Capture Receipt</strong> for replication
          </p>
        `;
        statusText.textContent = "Start";
      }
    }

    tabHello.addEventListener("click", () => setActiveTab("hello"));
    tabMission.addEventListener("click", () => setActiveTab("mission"));
    tabStart.addEventListener("click", () => setActiveTab("start"));

    // =========================
    // Three.js scene (minimal)
    // =========================
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.01, 1000);
    camera.position.set(0, 0, 3.2);

    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
    renderer.setPixelRatio(Math.min(2, window.devicePixelRatio || 1));
    renderer.setSize(window.innerWidth, window.innerHeight);

    // Lights
    const key = new THREE.DirectionalLight(0xffffff, 1.0);
    key.position.set(2, 1.5, 2);
    scene.add(key);

    const rim = new THREE.DirectionalLight(0x88ffee, 0.35);
    rim.position.set(-2, 0.6, -2);
    scene.add(rim);

    const amb = new THREE.AmbientLight(0xffffff, 0.15);
    scene.add(amb);

    // Stars (subtle, not noisy)
    function makeStars(count=1200){
      const geo = new THREE.BufferGeometry();
      const pos = new Float32Array(count * 3);
      for (let i=0;i<count;i++){
        const r = 70 * Math.random() + 10;
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos(2*Math.random()-1);
        pos[i*3+0] = r * Math.sin(phi) * Math.cos(theta);
        pos[i*3+1] = r * Math.cos(phi);
        pos[i*3+2] = r * Math.sin(phi) * Math.sin(theta);
      }
      geo.setAttribute("position", new THREE.BufferAttribute(pos, 3));
      const mat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.08, transparent:true, opacity:0.45 });
      const pts = new THREE.Points(geo, mat);
      return pts;
    }
    scene.add(makeStars());

    // Globe (clean monochrome)
    const globeGroup = new THREE.Group();
    scene.add(globeGroup);

    const globeGeo = new THREE.SphereGeometry(1, 64, 64);
    const globeMat = new THREE.MeshStandardMaterial({
      color: 0x0b0d11,
      metalness: 0.2,
      roughness: 0.85,
      emissive: 0x000000
    });
    const globe = new THREE.Mesh(globeGeo, globeMat);
    globeGroup.add(globe);

    // Faint latitude/longitude grid (minimal)
    const gridMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent:true, opacity: 0.06, wireframe:true });
    const grid = new THREE.Mesh(new THREE.SphereGeometry(1.002, 36, 18), gridMat);
    globeGroup.add(grid);

    // Atmosphere glow (subtle)
    const atmMat = new THREE.MeshBasicMaterial({ color: 0x9adcff, transparent:true, opacity: 0.08 });
    const atm = new THREE.Mesh(new THREE.SphereGeometry(1.03, 64, 64), atmMat);
    globeGroup.add(atm);

    // Axis overlay (42° / 222°)
    let axisOn = false;
    let axisLine = null;

    // Simple lat/lon marker (Station)
    const stationGroup = new THREE.Group();
    globeGroup.add(stationGroup);

    function latLonToVec3(latDeg, lonDeg, radius=1.01){
      const lat = THREE.MathUtils.degToRad(latDeg);
      const lon = THREE.MathUtils.degToRad(lonDeg);
      const x = radius * Math.cos(lat) * Math.sin(lon);
      const y = radius * Math.sin(lat);
      const z = radius * Math.cos(lat) * Math.cos(lon);
      return new THREE.Vector3(x,y,z);
    }

    function makeGreatCircleLine(lat1, lon1, lat2, lon2){
      const steps = 256;
      const p1 = latLonToVec3(lat1, lon1, 1.02).normalize();
      const p2 = latLonToVec3(lat2, lon2, 1.02).normalize();

      // slerp points along arc
      const pts = [];
      for (let i=0;i<=steps;i++){
        const t = i/steps;
        const v = new THREE.Vector3().copy(p1).slerp(p2, t).multiplyScalar(1.02);
        pts.push(v);
      }

      const geo = new THREE.BufferGeometry().setFromPoints(pts);
      const mat = new THREE.LineBasicMaterial({ color: 0xb8fff0, transparent:true, opacity: 0.65 });
      return new THREE.Line(geo, mat);
    }

    function toggleAxis(){
      axisOn = !axisOn;
      if (axisOn){
        // Default demo anchor: Staunton-ish. Replace with your canonical origin if desired.
        // Origin (lat, lon):
        const originLat = 38.1608;
        const originLon = -79.0730;

        // Antipode:
        const antiLat = -originLat;
        const antiLon = (originLon + 180) > 180 ? (originLon - 180) : (originLon + 180);

        axisLine = makeGreatCircleLine(originLat, originLon, antiLat, antiLon);
        globeGroup.add(axisLine);
        statusText.textContent = "Axis: ON";
      } else {
        if (axisLine) globeGroup.remove(axisLine);
        axisLine = null;
        statusText.textContent = "Axis: OFF";
      }
    }

    function clearStations(){
      while(stationGroup.children.length) stationGroup.remove(stationGroup.children[0]);
    }

    function addStation(lat, lon){
      const dotGeo = new THREE.SphereGeometry(0.018, 16, 16);
      const dotMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
      const dot = new THREE.Mesh(dotGeo, dotMat);
      dot.position.copy(latLonToVec3(lat, lon, 1.03));
      stationGroup.add(dot);

      // small square frame behind (minimal “truth anchor” look)
      const frameGeo = new THREE.RingGeometry(0.030, 0.034, 4);
      const frameMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent:true, opacity: 0.8, side: THREE.DoubleSide });
      const frame = new THREE.Mesh(frameGeo, frameMat);
      frame.position.copy(latLonToVec3(lat, lon, 1.028));
      frame.lookAt(frame.position.clone().multiplyScalar(2));
      stationGroup.add(frame);

      statusText.textContent = `Station set (${lat.toFixed(3)}, ${lon.toFixed(3)})`;
    }

    // Minimal “Capture Receipt”
    function captureReceipt(){
      const now = new Date();
      const payload = {
        app: "MAP E.D.E.N.",
        ts: now.toISOString(),
        axis: axisOn ? "ON" : "OFF",
        stations: stationGroup.children.length ? "1+" : "0",
        note: "Local-first demo receipt"
      };
      try{
        localStorage.setItem("eden_last_receipt", JSON.stringify(payload, null, 2));
      }catch(e){}
      statusText.textContent = "Receipt captured";
      // Keep it minimal: use alert once; replace later with a dedicated receipt view.
      alert("Capture Receipt saved locally.\n\n" + JSON.stringify(payload, null, 2));
    }

    // Hook up buttons
    $("toggleAxisBtn").addEventListener("click", toggleAxis);

    $("addStationBtn").addEventListener("click", () => {
      // Minimal input (fast, user-friendly). Replace later with “tap globe to drop pin”.
      const lat = parseFloat(prompt("Station Latitude (e.g., 38.161):", "38.161"));
      const lon = parseFloat(prompt("Station Longitude (e.g., -79.073):", "-79.073"));
      if (Number.isFinite(lat) && Number.isFinite(lon)){
        clearStations();
        addStation(lat, lon);
      } else {
        statusText.textContent = "Station canceled";
      }
    });

    $("captureBtn").addEventListener("click", captureReceipt);

    // Touch/drag rotate (minimal, no heavy controls)
    let dragging = false;
    let lastX = 0, lastY = 0;

    function onDown(x,y){ dragging = true; lastX=x; lastY=y; }
    function onMove(x,y){
      if(!dragging) return;
      const dx = (x-lastX)/window.innerWidth;
      const dy = (y-lastY)/window.innerHeight;
      lastX=x; lastY=y;

      globeGroup.rotation.y += dx * 2.8;
      globeGroup.rotation.x += dy * 1.6;
      globeGroup.rotation.x = Math.max(-1.1, Math.min(1.1, globeGroup.rotation.x));
    }
    function onUp(){ dragging = false; }

    window.addEventListener("pointerdown", (e)=> onDown(e.clientX, e.clientY), {passive:true});
    window.addEventListener("pointermove", (e)=> onMove(e.clientX, e.clientY), {passive:true});
    window.addEventListener("pointerup", onUp, {passive:true});
    window.addEventListener("pointercancel", onUp, {passive:true});

    // Gentle auto-drift (only when not dragging)
    function animate(){
      requestAnimationFrame(animate);
      if(!dragging) globeGroup.rotation.y += 0.0012;
      renderer.render(scene, camera);
    }
    animate();

    // Resize
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Start view defaults
    setActiveTab("hello");
    statusText.textContent = "Ready";
  </script>
</body>
</html>
