<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MAP E.D.E.N. ‚Äî Globe Simulator</title>

  <!-- LOCK üîê: MAP E.D.E.N. index.html vFinal (Welcome uses welcome1.html) -->

  <style>
    :root{
      --bg:#050508;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.085);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.55);
      --good: #62ffbf;
      --warn: #ffd36b;
      --bad: #ff6b6b;
    }
    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      text-rendering:geometricPrecision;
      overflow:hidden;
    }

    /* Fullscreen canvas */
    #stage{ position:fixed; inset:0; }
    canvas{ width:100%; height:100%; display:block; }

    /* Top-left small brand pill */
    .brand{
      position:fixed;
      top:12px; left:12px;
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      backdrop-filter: blur(10px);
      z-index: 20;
      user-select:none;
    }
    .brand img{ width:30px; height:30px; border-radius:10px; object-fit:cover; }
    .brand .t1{ font-weight:700; letter-spacing:.08em; }
    .brand .t2{ color:var(--muted2); font-size:12px; margin-top:2px; }

    /* Bottom control bar */
    .dock{
      position:fixed;
      left:50%; bottom:14px;
      transform:translateX(-50%);
      display:flex; gap:10px;
      padding:10px;
      border-radius:18px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(12px);
      z-index: 20;
    }
    .btn{
      display:flex; align-items:center; gap:10px;
      padding:12px 14px;
      border-radius:14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.92);
      font-weight:700;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{ transform: translateY(1px); }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(255,255,255,.25);
      box-shadow: 0 0 0 2px rgba(0,0,0,.2) inset;
    }
    .btn.done .dot{ background: var(--good); box-shadow: 0 0 16px rgba(98,255,191,.35); }

    /* Modal */
    .modalWrap{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.62);
      z-index: 50;
      padding: 18px;
    }
    .modalWrap.open{ display:flex; }

    .modal{
      width:min(980px, 94vw);
      height:min(86vh, 860px);
      border-radius: 22px;
      background: rgba(10,10,14,.92);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 20px 80px rgba(0,0,0,.55);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .modalTop .title{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size: 13px;
    }
    .close{
      width:38px; height:38px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.9);
      cursor:pointer;
      display:grid;
      place-items:center;
      font-size: 18px;
      user-select:none;
    }

    .modalBody{
      flex:1;
      padding: 14px;
      overflow:auto;
    }

    .card{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding: 14px;
    }

    .iframeWrap{
      width:100%;
      height:100%;
      border-radius: 16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    iframe{
      width:100%;
      height:100%;
      border:0;
      background: transparent;
      /* allow pinch zoom + scroll */
      touch-action: pan-x pan-y pinch-zoom;
    }

    .p{ color: rgba(255,255,255,.74); line-height:1.7; font-size:16px; }
    .h{ font-weight:800; letter-spacing:.18em; text-transform:uppercase; font-size:13px; margin: 0 0 10px; }
    .small{ color: rgba(255,255,255,.55); font-size:12px; line-height:1.6; }

    /* Mobile */
    @media (max-width:520px){
      .dock{ width: calc(100vw - 18px); justify-content:space-between; }
      .btn{ padding: 11px 10px; font-size:11px; letter-spacing:.10em; }
      .brand{ max-width: calc(100vw - 24px); }
    }
  </style>

  <!-- Import map (no build system needed for GitHub Pages) -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.1/examples/jsm/"
    }
  }
  </script>
</head>

<body>
  <div id="stage"></div>

  <div class="brand" aria-label="MAP E.D.E.N.">
    <img src="assets/asset_4.png" alt="Mandorla mark" />
    <div>
      <div class="t1">MAP E.D.E.N.</div>
      <div class="t2">Earth Diametric Energy Network ‚Ä¢ Simulator</div>
    </div>
  </div>

  <div class="dock" role="navigation" aria-label="MAP E.D.E.N. Controls">
    <div id="btnWelcome" class="btn"><span class="dot"></span><span>Welcome</span></div>
    <div id="btnMission"  class="btn"><span class="dot"></span><span>Mission</span></div>
    <div id="btnSwitch"   class="btn"><span class="dot"></span><span>Switchboard</span></div>
  </div>

  <!-- Modal -->
  <div id="modalWrap" class="modalWrap" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalTop">
        <div class="title" id="modalTitle">WELCOME</div>
        <div class="close" id="modalClose" aria-label="Close">√ó</div>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <script type="module">
    import * as THREE from "three";
    import { EffectComposer } from "three/addons/postprocessing/EffectComposer.js";
    import { RenderPass } from "three/addons/postprocessing/RenderPass.js";
    import { UnrealBloomPass } from "three/addons/postprocessing/UnrealBloomPass.js";

    // ---- CONFIG (Welcome uses ONLY welcome1.html) ----
    const WELCOME_URL = "welcome1.html";

    // UI
    const modalWrap = document.getElementById("modalWrap");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");
    const modalClose = document.getElementById("modalClose");

    const btnWelcome = document.getElementById("btnWelcome");
    const btnMission  = document.getElementById("btnMission");
    const btnSwitch   = document.getElementById("btnSwitch");

    function openModal(title, contentNode){
      modalTitle.textContent = title;
      modalBody.innerHTML = "";
      modalBody.appendChild(contentNode);
      modalWrap.classList.add("open");
      modalWrap.setAttribute("aria-hidden","false");
    }
    function closeModal(){
      modalWrap.classList.remove("open");
      modalWrap.setAttribute("aria-hidden","true");
    }
    modalClose.addEventListener("click", closeModal);
    modalWrap.addEventListener("click", (e)=>{ if(e.target === modalWrap) closeModal(); });
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

    // Buttons -> green lights after press
    function markDone(btn){ btn.classList.add("done"); }

    btnWelcome.addEventListener("click", ()=>{
      markDone(btnWelcome);
      const wrap = document.createElement("div");
      wrap.className = "iframeWrap";
      const iframe = document.createElement("iframe");
      iframe.src = WELCOME_URL;
      iframe.setAttribute("title","Welcome");
      iframe.loading = "eager";
      iframe.referrerPolicy = "no-referrer";
      wrap.appendChild(iframe);
      openModal("WELCOME", wrap);
    });

    btnMission.addEventListener("click", ()=>{
      markDone(btnMission);
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="h">MISSION</div>
        <div class="p">
          MAP E.D.E.N. is the operational field platform for Project E.D.E.N. (Earth Diametric &amp; Energy Network)‚Äîa secure, repeatable way to
          run real-world tests along defined Earth corridors, beginning with the 42¬∞ / 222¬∞ diametric axis (42¬∞ and 222¬∞ are opposite bearings on
          the same straight line). Based on a 20+ year personal observation record, the Founder identified ‚Äú222‚Äù as a persistent recurring numeric
          event marker across routine environments (time displays, identifiers, signage). This long-duration recurrence served as the initial
          trigger for structuring Project E.D.E.N. as a measurement-first field program.
          <br/><br/>
          Over time, and in multiple documented sessions, the ‚Äú222‚Äù event marker also coincided with a compass bearing of 222¬∞ (SW)‚Äîreinforcing the
          42¬∞ / 222¬∞ line as a repeatable corridor for formal testing. MAP E.D.E.N. equips trusted operators with clear protocols to collect
          environmental field measurements and navigation-behavior observations (including human biological magnetoreception and magnetically
          influenced orientation, homing, and migratory navigation in animals and insects), so results can be compared across time.
          <br/><br/>
          <div class="small">Tip: You can pinch &amp; zoom the Welcome page and scroll top-to-bottom.</div>
        </div>
      `;
      openModal("MISSION", card);
    });

    btnSwitch.addEventListener("click", ()=>{
      markDone(btnSwitch);
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="h">SWITCHBOARD</div>
        <div class="p">
          This panel is reserved for future MAP E.D.E.N. modules (maps, corridors, station tools, logging, operator kit links).
          <br/><br/>
          For now:
          <ul style="margin:10px 0 0 18px; color: rgba(255,255,255,.74); line-height:1.7;">
            <li>Globe Simulator (this view)</li>
            <li>Welcome (welcome1.html)</li>
            <li>Mission</li>
          </ul>
        </div>
        <div class="small" style="margin-top:10px;">
          Assets must remain exactly:
          <code>assets/asset_1.png</code>,
          <code>assets/asset_3.png</code>,
          <code>assets/asset_4.png</code>.
        </div>
      `;
      openModal("SWITCHBOARD", card);
    });

    // ---- THREE.JS GLOBE (clean + stable) ----
    const stage = document.getElementById("stage");
    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:false });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    stage.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050508);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 2000);
    camera.position.set(0, 0, 3.2);

    const ambient = new THREE.AmbientLight(0xffffff, 0.45);
    scene.add(ambient);

    const sun = new THREE.DirectionalLight(0xffffff, 1.15);
    sun.position.set(5, 1.5, 2);
    scene.add(sun);

    // Earth
    const earthGroup = new THREE.Group();
    scene.add(earthGroup);

    const loader = new THREE.TextureLoader();
    const texEarth = loader.load("https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg");
    texEarth.colorSpace = THREE.SRGBColorSpace;

    const texNormal = loader.load("https://threejs.org/examples/textures/planets/earth_normal_2048.jpg");
    const texSpec   = loader.load("https://threejs.org/examples/textures/planets/earth_specular_2048.jpg");

    const earthGeo = new THREE.SphereGeometry(1, 96, 96);
    const earthMat = new THREE.MeshPhongMaterial({
      map: texEarth,
      normalMap: texNormal,
      specularMap: texSpec,
      shininess: 12
    });
    const earth = new THREE.Mesh(earthGeo, earthMat);
    earthGroup.add(earth);

    // Atmosphere glow (simple additive sphere)
    const atmoGeo = new THREE.SphereGeometry(1.03, 96, 96);
    const atmoMat = new THREE.MeshBasicMaterial({
      color: 0x7fdcff,
      transparent: true,
      opacity: 0.08,
      blending: THREE.AdditiveBlending
    });
    const atmo = new THREE.Mesh(atmoGeo, atmoMat);
    earthGroup.add(atmo);

    // Stars (big sphere, inside)
    const starTex = loader.load("https://threejs.org/examples/textures/galaxy_starfield.png");
    starTex.colorSpace = THREE.SRGBColorSpace;
    const starGeo = new THREE.SphereGeometry(60, 48, 48);
    const starMat = new THREE.MeshBasicMaterial({ map: starTex, side: THREE.BackSide, transparent:true, opacity:0.9 });
    const stars = new THREE.Mesh(starGeo, starMat);
    scene.add(stars);

    // Postprocessing bloom
    const composer = new EffectComposer(renderer);
    composer.addPass(new RenderPass(scene, camera));
    const bloom = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 0.75, 0.35, 0.85);
    composer.addPass(bloom);

    // Controls (simple drag rotate + inertia)
    let isDown = false;
    let lastX = 0, lastY = 0;
    let velX = 0, velY = 0;
    const DAMPING = 0.92;
    const ROTATE_SPEED = 0.0032;

    function pointerDown(x,y){ isDown = true; lastX = x; lastY = y; }
    function pointerMove(x,y){
      if(!isDown) return;
      const dx = x - lastX;
      const dy = y - lastY;
      lastX = x; lastY = y;
      velX = dx * ROTATE_SPEED;
      velY = dy * ROTATE_SPEED;
      earthGroup.rotation.y += velX;
      earthGroup.rotation.x += velY;
      earthGroup.rotation.x = Math.max(-1.25, Math.min(1.25, earthGroup.rotation.x));
    }
    function pointerUp(){ isDown = false; }

    renderer.domElement.addEventListener("pointerdown", (e)=>pointerDown(e.clientX, e.clientY));
    renderer.domElement.addEventListener("pointermove", (e)=>pointerMove(e.clientX, e.clientY));
    renderer.domElement.addEventListener("pointerup", pointerUp);
    renderer.domElement.addEventListener("pointercancel", pointerUp);
    renderer.domElement.addEventListener("pointerleave", pointerUp);

    // Wheel zoom
    renderer.domElement.addEventListener("wheel", (e)=>{
      e.preventDefault();
      const delta = Math.sign(e.deltaY) * 0.12;
      camera.position.z = THREE.MathUtils.clamp(camera.position.z + delta, 1.9, 6.5);
    }, { passive:false });

    function onResize(){
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      composer.setSize(window.innerWidth, window.innerHeight);
      bloom.setSize(window.innerWidth, window.innerHeight);
    }
    window.addEventListener("resize", onResize);

    // Render loop
    function animate(){
      requestAnimationFrame(animate);

      // Slow auto-rotation
      earthGroup.rotation.y += 0.00055;

      // Inertia
      if(!isDown){
        velX *= DAMPING;
        velY *= DAMPING;
        earthGroup.rotation.y += velX;
        earthGroup.rotation.x += velY;
        earthGroup.rotation.x = Math.max(-1.25, Math.min(1.25, earthGroup.rotation.x));
      }

      // Subtle star drift
      stars.rotation.y += 0.00008;

      composer.render();
    }
    animate();
  </script>
</body>
</html>
